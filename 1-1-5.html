<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./public/favicon.ico" />
    <meta http-equiv="cache-control" content="no-cache" />
    <title></title>
    <link rel="stylesheet" href=" https://necolas.github.io/normalize.css/8.0.1/normalize.css" />
    <link rel="stylesheet" href="./hightlight/default.min.css" />
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/copybutton.css" />
    <link rel="stylesheet" href="./css/hightlight.css" />
    <script src="./hightlight/hightlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BEVZJDBC7Z"></script>
    <script src="./js/gtag.js"></script>
  </head>

  <body>
    <header>
      <nav>
        <h1>
          <span id="toggle-menu"></span>
          <a href="index.html"></a>
        </h1>
      </nav>
    </header>
    <main>
      <aside>
        <nav></nav>
      </aside>
      <article>
        <h2 id="1-1-5">1-1-5 現代 CSS 特色</h2>
        <h3>CSS 變數和主題切換優雅實現</h3>
        <p>
          CSS 變數時代確實已經到來。注意，這裡所說的不是CSS 前置處理器（類似
          Less、Sass）中的變數，而是實實在在地原生支援特性。
        </p>
        <pre><code class="language-css">
main {
  background: white;
  color: #555;
}
a,
a:link {
  color: #639a67;
}
a:hover {
  color: #205d67;
}
        </code></pre>
        <p>借助 CSS 變數，我們可以對顏色色值進行設定。</p>
        <pre><code class="language-css">
:root {
  --bg: White;
  --text-color: #555;
  --link-color: #639a67;
  --link-hover: #205d67;
}
        </code></pre>
        <p>這樣一來，我們可以直接使用色值來實現程式簡化。</p>
        <pre><code class="language-css">
main {
  background: var (--bg);
  color: var (--text-color);
}
a,
a:link {
  color: var (--link-color);
}
a:hover {
  color: var (--link-hover);
}
        </code></pre>
        <p>
          這一點很好了解，在任何語言中，變數都是個好東西：它可以降低維護成本，甚至實現更好的效能。
        </p>
        <p>
          CSS 變數語法也很簡單：我們使用「--變數名稱」的方式定義變數，使用
          var(--變數名稱)的方式消費變數。
        </p>
        <p>
          CSS變數的相容性「出乎意料」得好，大部分行動端都已經可以使用 CSS 變數，PC
          端的新版本瀏覽器基本也都已經支援該變數。
        </p>
        <p>:root 使用方式是在 html 根節點下定義，並如上面的範例進行變數宣告。</p>
        <p>除了簡單地應用變數，下面介紹一些進階用法。</p>
        <h4>使用CSS變數實現主題切換</h4>
        <p>
          對於一鍵切換主題這一功能，以往的寶現方式較為複雜。如今，借助 CSS
          變數，一切都變得容易起來。參考以下程式。
        </p>
        <pre><code class="language-css">
:root {
  --bg: white;
  --text-color: #555;
}
        </code></pre>
        <p>定義一個，pink-theme 來對應粉色主題，程式如下。</p>
        <pre><code class="language-css">
.pink-theme {
  --bg: hotpink;
  --text-color: white;
}
        </code></pre>
        <p>指定套用的元素。</p>
        <pre><code class="language-css">
main {
  background: var(--bg);
  color: var(--text-color);
}
        </code></pre>
        <p>這樣一來，切換主題就變得非常簡單了，程式如下。</p>
        <pre><code class="language-js">
const toggleBtn = document.querySelector('.toggle-theme')
const main = document.querySelector('main')
toggleBtn.addEventListener('click', (e) => {
  e.preventDefault()
  if (main.classList.contains('pink-theme')) {
    // 目前主題為粉色主題，需要移除 pink-theme class
    main.classList.remove('pink-theme')
    toggleBtn.innerText = '切換為粉色少女主題'
  } else {
    main.classList.add('pink-theme')
    toggleBtn.innerText = '切換正常主題色'
  }
})
        </code></pre>
        <div class="border-block"><button class="toggle-theme">切換為粉色少女主題</button></div>
        <h4>CSS Modules 理論和實戰</h4>
        <p>
          如何維護大型專案的 z-index，如何維護 CSS 選擇器和樣式之間的衝突。是接下來這個單元的重點。
        </p>
        <h4>CSS Modules</h4>
        <p>
          CSS Modules是指，專案中的所有 class 名稱預設都是局部有作用的。 其實，CSS Modules
          並不是一個官方標準，更不是瀏覽器的機制，因為它依賴我們的專案建置過程，因此以它為基礎的實現常常需要借助
          webpack 或其他建置工具可以將 class 名稱唯一化，進一步使其只在局部有作用。
        </p>
        <pre><code class="language-html">
&lt;div class="test"&gt;This is a test&lt;/div&gt;
        </code></pre>
        <p>對應的樣式表如下。</p>
        <pre><code class="language-css">
.test{
  color: red
}
        </code></pre>
        <p>經過編譯建置後，對應的 HTML 程式內容如下所示。</p>
        <pre><code class="language-html">
&lt;div class="_style_test_309571057"&gt;
  This is a test
&lt;/div&gt;
        </code></pre>
        <p>同時，經過編譯建置後，對應的 CSS 程式內容如下所示。</p>
        <pre><code class="language-css">
._style_test_309571057{
  color: red;
}
        </code></pre>
        <p>
          其中，class
          名是動態產生的，在整個專案中這個名字是唯一的。透過命名標準的唯一性，便達到了避免樣式衝突的目的。
        </p>
        <p>
          仔細想來，這樣的解決方案似乎有一個問題：如何實現樣式重複使用？因為產 生了全域唯一的 class
          名，所以我們如何像傳統方式那樣實現樣式重複使用呢？ 從原理上想，全域唯一的 class
          名是在建置過程中產生的，所以如果能夠在建置過程中進行標識，表示該 class
          將被重複使用，就可以解決問題了。
        </p>
        <p>
          這樣的方式需要依靠 composes 關鍵字實現。我們來看一個實際範例。 在專案樣式表 style.css
          檔案中，有以下相關程式。
        </p>
        <pre><code class="language-css">
.common { 
  color: red;
}
.test {
  composes: common; 
  font-size: 18px;
}
        </code></pre>
        <p>注意，這裡使用 composes 關鍵字在 .test 中連結了 .common 樣式。</p>
        <p>專案的HTML 檔案中引用了 style.css檔案，並使用了 CSS Modules特性，程式如下。</p>
        <pre><code class="language-html">
import style from "./style.css"; 
&lt;div class="${style.test}"&gt;
  This is a test
&lt;/div&gt;
        </code></pre>
        <p>以上程式經過編譯建置後，獲得的程式如下。</p>
        <pre><code class="language-html">
&lt;div class="_style__test_0980340_style_common_404840"&gt;
  This is a test 
&lt;/div&gt;
        </code></pre>
        <p>我們看到， div 的 class 中加入了 _style_common_404840 ，這樣就實現了重複使用樣式‧</p>
        <h4>CSS Modules 實戰</h4>
        <p>本節將使用 webpack 來建置一個專案，一步一步進行分析說明。</p>
        <h5>1.建立專案</h5>
        <p>透過指令 npm init -y 進行專案初始化建立。 此時產生的 package.json 檔案中的內容如下。</p>
        <pre><code class="language-json">
{
  "name": "css-modules",
  "version": "1.0.0",
  "description": "README. md",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
}
        </code></pre>
        <h5>2.建立必要檔案</h5>
        <p>
          輸入指令 mkdir src 來建立 src 檔案，同時在該目錄下建立 index.html 檔案，指令是 touch
          index.html。接著，在 ./src 資料夾中建立 index.js、style.css 和 app.css 檔案。
        </p>
        <p>其中 index.js 檔案中的程式如下。</p>
        <pre><code class="language-js">
import blueStyle from './style.css'
import greenStyle from './app.css'
let html = `
&lt;h2 class="${bluestyle.my_css_selector}"&gt;I should be displayed in blue.&lt;/h2&gt;
&lt;br/&gt;
&lt;h2 class="${greenstyle.my_css_selector}"&gt;I should be displayed in green.&lt;/h2&gt;`
document.write(html)
        </code></pre>
        <p>style.css 檔案中的程式如下。</p>
        <pre><code class="language-css">
.my_css_selector{
  color: blue;
}
        </code></pre>
        <p>app.css 檔案中的程式如下。</p>
        <pre><code class="language-css">
.my_css_selector {
  color: green;
}
        </code></pre>
        <p>在 style.css 和 app.css 這兩個樣式檔案中，使用了相同的 class 名。</p>
        <h5>3.安裝依賴</h5>
        <p>
          接下來安裝 webpack、webpack-cli、Babel 全家桶(babel-core、babel-loader、 abel-preset-env
          )、對應的 loaders ( css-loader 、 style-loader) 及 extract-text-webpack-plugin 外掛程式。
        </p>
        <p>
          強烈建議安裝版本遵循以下程式設定，否則會出現類似 webpack 版本和
          extract-text-webpack-plugin 不相容等版本依賴問題。
        </p>
        <pre><code class="language-json">
{
  "babel-core": "^6.26.3",
  "babel-loader": "^7.1.4",
  "babel-preset-env": "^1.6.1",
  "css-loader": "^0.28.11",
  "extract-text-webpack-plugin": "^4.0.0-beta.0",
  "style-loader": "^0.21.0",
  "webpack": "^4.1.0",
  "webpack-cli": "^3.1.1"
}
        </code></pre>
        <p>按照正常流程走下來，package.json 檔案中的程式如下所示。</p>
        <pre><code class="language-json">
{
  "name": "css-modules",
  "version": "1.0.0",
  "description": "[README.md](http://readme.md/)",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "babel-core": "^6.26.3",
    "babel-loader": "^7.1.4",
    "babel-preset-env" : "^1.6.1",
    "css-loader": "^0.28.11",
    "extract-text-webpack-plugin": "^4.0.0-beta.0",
    "style-loader": "^0.21.0",
    "webpack" : "^4.1.0",
    "webpack-cli": "^3.1.1"
  }
}
        </code></pre>
        <h5>4.撰寫 webpack 設定</h5>
        <p>建立 webpack 設定檔，如下。</p>
        <pre><code class="language-bash">
touch webpack.config.js
        </code></pre>
        <p>撰寫 webpack 設定內容，如下。</p>
        <pre><code class="language-js">
var ExtractTextPlugin = require('extract-text-webpack-plugin')
module.exports = {
  entry: './src',
  output: {
    path: __dirname + '/build',
    filename: 'bundle.js'
  },
  module: {
    rules: [
      {
        test: /\.js/,
        loader: 'babel-loader',
        include: __dirname + '/src'
      },
      {
        test: /\.css/,
        loader: ExtractTextPlugin.extract(
          'css-loader?modules&importLoaders=1&localIdentName=[name]__[local]__[hash: base64:5]'
        )
      }
    ]
  },
  plugins: [new ExtractTextPlugin('styles.Css')]
}
        </code></pre>
        <p>
          這裡使用了 extract-text-webpack-plugin 外掛程式，並定義外掛程式分析入口為./sre
          目錄，外掛程式進行處理後，輸出結果到 __dirname + '/build' 目錄中。 對副檔名為 .css
          的檔案使用 css-loader 進行解析，輸出樣式內容到 styles.css 檔案中，並在 index.html
          檔案中引用 styles.css 檔案。 注意，這裡為 css-loader 設定了 modules 參數，並進行了 CSS
          Modules 處理。
        </p>
        <h5>5.撰寫 npm script 並執行</h5>
        <p>最後，將 package.json 中的 script 指令改為以下形式。</p>
        <pre><code class="language-json">
"scripts": {
  "start": "webpack --mode development"
}
        </code></pre>
        <p>使用 npm run stat 指令來執行 webpack，此時 package.json 檔案中的程式如下。</p>
        <pre><code class="language-json">
{
  "name": "css-modules",
  "version": "1.0.0",
  "description": "README.md",
  "main": "index.js",
  "scripts": {
    "start": "webpack --mode development"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "babel-core": "^6.26.3",
    "babel-loader": "^7.1.4",
    "babel-preset-env" : "^1.6.1",
    "css-loader": "^0.28.11",
    "extract-text-webpack-plugin": "^4.0.0-beta.0",
    "style-loader": "^0.21.0",
    "webpack" : "^4.1.0",
    "webpack-cli": "^3.1.1"
  }
}
        </code></pre>
        <p>
          執行 npm start，獲得輸出，開啟頁面會發現，在編譯過程中完成了對樣式的 CSS Modules 處理。
        </p>
        <pre><code class="language-css">

        </code></pre>
        <pre><code class="language-css">

        </code></pre>
        <pre><code class="language-css">

        </code></pre>

        <div class="border-block"></div>
      </article>
    </main>
  </body>
  <script type="module" src="./js/main.js"></script>
  <script>
    const toggleBtn = document.querySelector('.toggle-theme')
    const main = document.querySelector('main')
    toggleBtn.addEventListener('click', (e) => {
      e.preventDefault()
      if (main.classList.contains('pink-theme')) {
        // 目前主題為粉色主題，需要移除 pink-theme class
        main.classList.remove('pink-theme')
        toggleBtn.innerText = '切換為粉色少女主題'
      } else {
        main.classList.add('pink-theme')
        toggleBtn.innerText = '切換正常主題色'
      }
    })
  </script>
</html>
<style>
  :root {
    --bg: white;
    --text-color: #000;
  }
  .pink-theme {
    --bg: hotpink;
    --text-color: white;
  }
  main {
    background: var(--bg);
    color: var(--text-color);
  }
</style>
